@namespace Poke.MoveTranslator.PWA.Components
@using Newtonsoft.Json
@inherits MoveTranslatorBase

<MudPaper Class="d-flex flex-column" Elevation="0" Square="true">

    @if (IsLoading || IsInitializing)
    {
        <MudPaper Elevation="0" Square="true">
            <MudText Align="Align.Center">
                <MudProgressCircular Color="Color.Default" Indeterminate="true"/>
            </MudText>
        </MudPaper>
    }
    else if (Move != null)
    {
        <MudPaper Elevation="0" Square="true" Class="mt-4">
            <MudGrid>
                <MudItem xs="8">
                    <MudText Typo="Typo.h6">@MoveEnglishName</MudText>
                </MudItem>
                <MudItem xs="4">
                    <MudText Align="Align.Right">
                        <MudChip Label="true" Variant="Variant.Outlined" Size="Size.Small">@Move.Type.Name</MudChip>
                    </MudText>
                </MudItem>
            </MudGrid>
            <MudDivider class="my-2"/>
            <MudText Class="mb-1" Align="Align.Justify">
                @Move.FlavorTextEntries.LastOrDefault(f => f.Language.Name == "en")?.FlavorText
            </MudText>
            <MudText Class="mb-1" Align="Align.Justify">
                @Move.EffectEntries.LastOrDefault(f => f.Language.Name == "en")?.ShortEffect
            </MudText>
            <MudDivider class="my-2"/>
            <MudText>
                <strong>Accuracy</strong> @(Move.Accuracy?.ToString() ?? "-/-")
            </MudText>
            <MudText>
                <strong>Power</strong> @(Move.Power?.ToString() ?? "-/-")
            </MudText>
            <MudText>
                <strong>PP</strong> @Move.Pp
            </MudText>
        </MudPaper>
    }
</MudPaper>

<MudPaper Elevation="8" Square="true" Class="pa-4" Style="position: fixed;bottom:0;left: 0;right: 0">
    @if (!IsInitializing)
    {
        <MudGrid Justify="@Justify.Center">
            @if (SearchHistory.Count > 0)
            {
                <MudItem xs="12">
                    <MudText Typo="Typo.subtitle2">Search History</MudText>
                    <MudChipSet AllClosable="true" Class="py-1" Style="overflow-x: auto;white-space: nowrap">
                        @foreach (NameByLanguage item in SearchHistory)
                        {
                            <MudChip Text="@item.Name" OnClick="@(() => OnLastValueClick(item))" OnClose="@(() => SearchHistory.Remove(item))" Size="@Size.Small"/>
                        }
                    </MudChipSet>
                </MudItem>
            }
            @if (MoveNameSuggestions.Count > 0)
            {
                <MudItem xs="12">
                    <MudText Typo="Typo.subtitle2">Did you mean:</MudText>
                    <MudChipSet Class="py-1" Style="overflow-x: auto;white-space: nowrap">
                        @foreach (string suggestion in MoveNameSuggestions.Values)
                        {
                            <MudChip Text="@suggestion" Variant="Variant.Outlined" OnClick="@(async () => { MoveName = suggestion; await LoadMove();})" Size="@Size.Small"/>
                        }
                    </MudChipSet>
                </MudItem>
            }
            <MudItem xs="4">
                <MudSelect T="string" @bind-Value="Language" Label="Language" AnchorOrigin="Origin.BottomCenter" Disabled="@IsLoading">
                    @foreach (string languageCode in Languages.Keys)
                    {
                        <MudSelectItem Value="@languageCode">@(Languages[languageCode])</MudSelectItem>
                    }
                </MudSelect>
            </MudItem>
            <MudItem xs="5">
                <MudTextField @bind-Value="MoveName" Label="Move name" Variant="Variant.Text" Disabled="@IsLoading" AutoFocus="true"/>
            </MudItem>
            <MudItem xs="3">
                <MudFab Color="Color.Primary" Icon="@Icons.Material.Filled.PlayCircleFilled" aria-label="play" OnClick="@LoadMove" Class="ml-auto d-flex d-sm-inline-flex" Disabled="IsButtonDisabled"/>
            </MudItem>
        </MudGrid>
    }
</MudPaper>